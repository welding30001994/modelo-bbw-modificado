     document.querySelectorAll('.close-order').forEach(button => {
                button.addEventListener('click', function() {
                    const orderId = parseInt(this.getAttribute('data-id'));
                    closeOrder(orderId);
                });
            });
        }
        
        // Renderizar historial
        function renderHistory() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';
            
            const currentHistory = tradeHistory.filter(order => order.pair === currentAsset);
            document.querySelector('#history .section-title span').textContent = currentHistory.length;
            
            currentHistory.forEach(order => {
                const orderElement = document.createElement('div');
                orderElement.className = `order order-${order.type}`;
                orderElement.innerHTML = `
                    <div class="order-info">
                        <div class="order-pair">${order.pair}</div>
                        <div class="order-type">${order.type.toUpperCase()} ${order.volume} LOTS • ${order.openTime}</div>
                    </div>
                    <div class="order-price">
                        <div>${order.closePrice}</div>
                        <div class="order-profit ${parseFloat(order.profit) >= 0 ? 'profit-positive' : 'profit-negative'}">
                            ${parseFloat(order.profit) >= 0 ? '+' : ''}${order.profit}
                        </div>
                    </div>
                `;
                historyList.appendChild(orderElement);
            });
        }
        
        // Cerrar una orden
        function closeOrder(orderId) {
            const orderIndex = openOrders.findIndex(order => order.id === orderId);
            if (orderIndex !== -1) {
                const order = openOrders[orderIndex];
                
                // Mover a historial
                tradeHistory.unshift({
                    ...order,
                    closeTime: new Date().toLocaleString(),
                    closePrice: order.currentPrice
                });
                
                // Actualizar balance
                balance += parseFloat(order.profit);
                document.querySelector('.balance').textContent = `$${balance.toFixed(2)}`;
                
                // Eliminar de órdenes abiertas
                openOrders.splice(orderIndex, 1);
                
                // Re-renderizar
                renderOpenOrders();
                renderHistory();
            }
        }
        
        // Actualizar gráfico
        function updateChart() {
            const candlesContainer = document.getElementById('candlesContainer');
            candlesContainer.innerHTML = '';
            
            // Generar velas aleatorias
            const candleCount = 30;
            const containerWidth = candlesContainer.offsetWidth;
            const candleWidth = 5;
            const spacing = (containerWidth - candleCount * candleWidth) / candleCount;
            
            let lastClose = assets[currentAsset].price;
            
            for (let i = 0; i < candleCount; i++) {
                const open = lastClose;
                const high = open + (Math.random() * 0.0015);
                const low = open - (Math.random() * 0.0015);
                const close = open + (Math.random() - 0.5) * 0.002;
                lastClose = close;
                
                const isBullish = close > open;
                const candleHeight = Math.abs(close - open) * 10000;
                const wickHeight = (high - low) * 10000;
                
                const candleX = i * (candleWidth + spacing);
                
                // Wick
                const wick = document.createElement('div');
                wick.className = 'candle wick';
                wick.style.left = `${candleX + candleWidth / 2}px`;
                wick.style.height = `${wickHeight}px`;
                wick.style.bottom = `calc(50% + ${(high - (high + low) / 2) * 10000}px)`;
                candlesContainer.appendChild(wick);
                
                // Candle body
                const candle = document.createElement('div');
                candle.className = 'candle';
                candle.style.left = `${candleX}px`;
                candle.style.height = `${candleHeight}px`;
                candle.style.bottom = `calc(50% + ${(open - (high + low) / 2) * 10000}px)`;
                candle.style.backgroundColor = isBullish ? 'var(--profit)' : 'var(--loss)';
                candlesContainer.appendChild(candle);
            }
        }
        
        // Cambiar de activo
        function setupAssetSelector() {
            document.querySelectorAll('.asset').forEach(asset => {
                asset.addEventListener('click', function() {
                    document.querySelector('.asset.active').classList.remove('active');
                    this.classList.add('active');
                    currentAsset = this.textContent;
                    
                    // Actualizar información del activo
                    document.querySelector('.asset-name').textContent = currentAsset;
                    updateCurrentPrice();
                    renderOpenOrders();
                    renderHistory();
                });
            });
        }
        
        // Configurar pestañas
        function setupTabs() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelector('.tab.active').classList.remove('active');
                    this.classList.add('active');
                    
                    const tabId = this.getAttribute('data-tab');
                    document.querySelector('.active-tab').classList.remove('active-tab');
                    document.getElementById(tabId).classList.add('active-tab');
                });
            });
        }
        
        // Configurar botones de compra/venta
        function setupTradeButtons() {
            document.getElementById('buyBtn').addEventListener('click', function() {
                openNewOrder('buy');
            });
            
            document.getElementById('sellBtn').addEventListener('click', function() {
                openNewOrder('sell');
            });
        }
        
        // Abrir nueva orden
        function openNewOrder(type) {
            const volume = parseFloat(document.getElementById('volume').value);
            const stopLoss = parseInt(document.getElementById('stopLoss').value);
            const takeProfit = parseInt(document.getElementById('takeProfit').value);
            
            if (volume <= 0 || isNaN(volume)) {
                alert('Please enter a valid volume');
                return;
            }
            
            const currentPrice = assets[currentAsset].price;
            const stopLossPrice = type === 'buy' 
                ? currentPrice - stopLoss * 0.0001 
                : currentPrice + stopLoss * 0.0001;
            const takeProfitPrice = type === 'buy' 
                ? currentPrice + takeProfit * 0.0001 
                : currentPrice - takeProfit * 0.0001;
            
            const newOrder = {
                id: Date.now(),
                pair: currentAsset,
                type: type,
                volume: volume,
                openPrice: currentPrice.toFixed(5),
                currentPrice: currentPrice.toFixed(5),
                stopLoss: stopLossPrice.toFixed(5),
                takeProfit: takeProfitPrice.toFixed(5),
                profit: '0.00',
                openTime: new Date().toLocaleTimeString()
            };
            
            openOrders.push(newOrder);
            renderOpenOrders();
        }
        
        // Inicializar la aplicación
        function initApp() {
            generateSampleOrders();
            setupAssetSelector();
            setupTabs();
